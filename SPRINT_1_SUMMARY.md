# Sprint 1: Media Upload + Local Storage + Thumbnails - –ò—Ç–æ–≥–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ–¥–∏–∞ (`app/services/media_service.py`)

- ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏–∞—Ç—é—Ä —Ç—Ä–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ (small, medium, large)
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (>5MB)
- ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ width/height –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤** - PNG, JPEG, GIF —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏

### 2. –£–ª—É—á—à–µ–Ω–Ω—ã–π endpoint –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–¥–∏–∞

- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä** –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ)
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ S3** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ S3 –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

### 3. –ù–æ–≤—ã–µ API endpoints

#### Media endpoints (`/api/v1/media/`)
- `GET /api/v1/media/{media_id}` - –ü–æ–ª—É—á–∏—Ç—å –º–µ–¥–∏–∞-—Ñ–∞–π–ª
  - Query –ø–∞—Ä–∞–º–µ—Ç—Ä `thumbnail`: `small`, `medium`, `large` (–¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- `GET /api/v1/media/{media_id}/info` - –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –º–µ–¥–∏–∞-—Ñ–∞–π–ª–∞

#### S3 endpoints (`/api/v1/s3/`)
- `POST /api/v1/s3/presigned-upload-url?memorial_id={id}` - –ü–æ–ª—É—á–∏—Ç—å presigned URL –¥–ª—è –ø—Ä—è–º–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ S3

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AWS S3 (`app/services/s3_service.py`)

- ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ S3** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚úÖ **Presigned URLs** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö URL –¥–ª—è –ø—Ä—è–º–æ–π –∑–∞–≥—Ä—É–∑–∫–∏/—Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- ‚úÖ **–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ S3
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–æ–≤ –≤ S3

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `boto3` –∏ `botocore` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å AWS S3

## üìã –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –º–∏–Ω–∏–∞—Ç—é—Ä—ã —Ç—Ä–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤:
- **small**: 150x150px - –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ –∏ –ø—Ä–µ–≤—å—é
- **medium**: 300x300px - –¥–ª—è –≥–∞–ª–µ—Ä–µ–π
- **large**: 800x800px - –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

–ú–∏–Ω–∏–∞—Ç—é—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `uploads/thumbnails/` –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ endpoint:
```
GET /api/v1/media/{media_id}?thumbnail=medium
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–ë–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (>5MB) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç—Å—è:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 1920x1920px
- –ö–∞—á–µ—Å—Ç–≤–æ JPEG: 85%
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π

### S3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:

1. **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
   - –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `uploads/`
   - –ú–∏–Ω–∏–∞—Ç—é—Ä—ã –≤ `uploads/thumbnails/`

2. **S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** (–ø—Ä–∏ `USE_S3=true`):
   - –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ S3 –ø–æ—Å–ª–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è presigned URLs –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `memorials/{memorial_id}/{file_id}.ext`

### Presigned URLs

–î–ª—è –ø—Ä—è–º–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ S3 –∏–∑ –∫–ª–∏–µ–Ω—Ç–∞:

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å presigned URL
POST /api/v1/s3/presigned-upload-url?memorial_id=1
{
  "file_name": "photo.jpg",
  "content_type": "image/jpeg",
  "file_size": 1024000
}

# –û—Ç–≤–µ—Ç:
{
  "upload_url": "https://s3.amazonaws.com/...",
  "s3_key": "memorials/1/uuid.jpg",
  "expires_in": 3600
}

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –Ω–∞–ø—Ä—è–º—É—é –≤ S3 –∏—Å–ø–æ–ª—å–∑—É—è upload_url
PUT {upload_url}
Content-Type: image/jpeg
[file data]
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
uploads/
‚îú‚îÄ‚îÄ {uuid}_{filename}          # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ thumbnails/
    ‚îú‚îÄ‚îÄ {uuid}_small.jpg       # –ú–∏–Ω–∏–∞—Ç—é—Ä—ã small
    ‚îú‚îÄ‚îÄ {uuid}_medium.jpg      # –ú–∏–Ω–∏–∞—Ç—é—Ä—ã medium
    ‚îî‚îÄ‚îÄ {uuid}_large.jpg       # –ú–∏–Ω–∏–∞—Ç—é—Ä—ã large
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è S3

–í `.env` —Ñ–∞–π–ª–µ:
```env
USE_S3=true
S3_BUCKET_NAME=your-bucket-name
S3_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

- **–§–æ—Ä–º–∞—Ç—ã**: JPEG, PNG, GIF
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: PNG —Å –∞–ª—å—Ñ–∞-–∫–∞–Ω–∞–ª–æ–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ RGB —Å –±–µ–ª—ã–º —Ñ–æ–Ω–æ–º
- **–ö–∞—á–µ—Å—Ç–≤–æ**: JPEG quality 85% (–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ä–∞–∑–º–µ—Ä–æ–º –∏ –∫–∞—á–µ—Å—Ç–≤–æ–º)
- **–ê–ª–≥–æ—Ä–∏—Ç–º**: LANCZOS –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ (–≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```bash
curl -X POST http://localhost:8000/api/v1/memorials/1/media/upload \
  -F "file=@photo.jpg"
```

–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:
- `id` - ID –º–µ–¥–∏–∞-—Ñ–∞–π–ª–∞
- `file_path` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
- `thumbnail_path` - –ø—É—Ç—å –∫ –º–∏–Ω–∏–∞—Ç—é—Ä–µ (medium)
- `file_url` - URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ (–µ—Å–ª–∏ S3)

### –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–¥–∏–∞-—Ñ–∞–π–ª–∞

```bash
# –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
GET /api/v1/media/1

# –ú–∏–Ω–∏–∞—Ç—é—Ä–∞ medium
GET /api/v1/media/1?thumbnail=medium

# –ú–∏–Ω–∏–∞—Ç—é—Ä–∞ small
GET /api/v1/media/1?thumbnail=small
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ–¥–∏–∞

```bash
GET /api/v1/media/1/info
```

–û—Ç–≤–µ—Ç:
```json
{
  "id": 1,
  "memorial_id": 1,
  "file_name": "photo.jpg",
  "file_size": 1024000,
  "mime_type": "image/jpeg",
  "media_type": "photo",
  "is_animated": false,
  "has_thumbnail": true,
  "file_exists": true,
  "width": 1920,
  "height": 1080,
  "created_at": "2024-01-01T12:00:00"
}
```

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ Sprint 1

- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–∑–¥–∞–µ—Ç –º–∏–Ω–∏–∞—Ç—é—Ä—ã
- [ ] –ú–∏–Ω–∏–∞—Ç—é—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ endpoint —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `thumbnail`
- [ ] –ë–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç—Å—è
- [ ] Endpoint `/api/v1/media/{id}` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–π–ª
- [ ] Endpoint `/api/v1/media/{id}/info` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- [ ] S3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞)
- [ ] Presigned URLs –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Ñ–∞–π–ª—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è)

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (Sprint 2)

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è D-ID / HeyGen –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Ñ–æ—Ç–æ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ-—Ñ–∞–π–ª–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é –¥–ª—è –≤–∏–¥–µ–æ
- –£–ª—É—á—à–µ–Ω–∏–µ worker'–æ–≤ –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üìö –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `backend/README.md` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å –Ω–æ–≤—ã–º–∏ endpoints
- `SPRINT_1_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ `/docs`

---

**–°—Ç–∞—Ç—É—Å Sprint 1**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω
**–î–∞—Ç–∞**: 2024
**–°–ª–µ–¥—É—é—â–∏–π —Å–ø—Ä–∏–Ω—Ç**: Sprint 2 - D-ID / HeyGen –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è + worker + video save

